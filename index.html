<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutor Availability</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #filters { margin-bottom: 15px; }
    #calendar { max-width: 900px; margin: 0 auto; }
  </style>
</head>
<body>
  <h2>Tutor Availability Calendar</h2>
  <div id="filters">
    <label for="tutorFilter">Tutor:</label>
    <select id="tutorFilter"><option value="all">All</option></select>
  </div>
  <div id="calendar"></div>

  <script>
    const sheetCSV = "https://docs.google.com/spreadsheets/d/1XP1gcvpECu4iNKQmnzNixb4Rux7fKZj9wfYBNLbJxAo/edit?usp=sharing";

    async function loadData() {
      const res = await fetch(sheetCSV);
      const text = await res.text();
      const rows = text.split("\n").slice(1);
      let events = [], tutors = new Set();

      rows.forEach(row => {
        const cols = row.split(",");
        if (cols.length < 3) return;
        let tutor = cols[0].trim();
        let date = cols[1].trim();
        let slots = cols[2].trim();
        tutors.add(tutor);

        if (slots && slots !== "Busy all day") {
          slots.split(",").forEach(slot => {
            let [start, end] = slot.split("-");
            events.push({
              title: tutor,
              start: date + "T" + start,
              end: date + "T" + end,
              extendedProps: { tutor }
            });
          });
        }
      });

      return { events, tutors: Array.from(tutors) };
    }

    document.addEventListener("DOMContentLoaded", async function() {
      const { events, tutors } = await loadData();
      const tutorFilter = document.getElementById("tutorFilter");
      tutors.forEach(t => {
        let opt = document.createElement("option");
        opt.value = t; opt.textContent = t;
        tutorFilter.appendChild(opt);
      });

      const calendarEl = document.getElementById("calendar");
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'timeGridWeek',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: events
      });

      calendar.render();

      tutorFilter.addEventListener("change", () => {
        const val = tutorFilter.value;
        calendar.getEvents().forEach(ev => {
          ev.setProp('display', (val === "all" || ev.extendedProps.tutor === val) ? 'auto' : 'none');
        });
      });
    });
  </script>
</body>
</html>

